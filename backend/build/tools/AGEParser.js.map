{"version":3,"file":"AGEParser.js","names":["_antlr","_interopRequireDefault","require","_config","_AgtypeLexer","_AgtypeParser","_CustomAgTypeListener","AGTypeParse","input","chars","antlr4","InputStream","lexer","AgtypeLexer","tokens","CommonTokenStream","parser","AgtypeParser","buildParseTrees","tree","agType","printer","CustomAgTypeListener","ParseTreeWalker","DEFAULT","walk","getResult","setAGETypes","_x","_x2","_setAGETypes","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee","client","types","oidResults","wrap","_context","prev","next","query","sent","rows","length","Error","setTypeParser","typelem","stop","onConnectQueries","_x3","_onConnectQueries","_callee2","v","_context2","abrupt","server_version"],"sources":["../../src/tools/AGEParser.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport antlr4 from 'antlr4';\nimport { cli } from 'winston/lib/winston/config';\nimport AgtypeLexer from './AgtypeLexer';\nimport AgtypeParser from './AgtypeParser';\nimport CustomAgTypeListener from './CustomAgTypeListener';\n\nfunction AGTypeParse(input) {\n    const chars = new antlr4.InputStream(input);\n    const lexer = new AgtypeLexer(chars);\n    const tokens = new antlr4.CommonTokenStream(lexer);\n    const parser = new AgtypeParser(tokens);\n    parser.buildParseTrees = true;\n    const tree = parser.agType();\n    const printer = new CustomAgTypeListener();\n    antlr4.tree.ParseTreeWalker.DEFAULT.walk(printer, tree);\n    return printer.getResult();\n}\n\nasync function setAGETypes(client, types) {\n    await client.query(`\n        CREATE EXTENSION IF NOT EXISTS age;\n        LOAD 'age';\n        SET search_path = ag_catalog, \"$user\", public;\n    `)\n\n    const oidResults = await client.query(`\n        select typelem\n        from pg_type\n        where typname = '_agtype';`);\n\n    if (oidResults.rows.length < 1)\n        throw new Error();\n\n    types.setTypeParser(oidResults.rows[0].typelem, AGTypeParse)\n}\n\nasync function onConnectQueries(client){\n    const v = await client.query('show server_version;');\n    return {server_version: v.rows[0].server_version};\n}\n\nexport {setAGETypes, AGTypeParse, onConnectQueries}\n"],"mappings":"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","ignoreList":[]}